generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model achievement {
  id              Int               @id @default(autoincrement())
  name            String
  description     String
  icon            String
  condition       String
  xpReward        Int               @default(0)
  roadmapId       Int?
  roadmap         roadmap?          @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  userachievement userachievement[]

  @@index([roadmapId])
}

model analytics {
  id       Int      @id @default(autoincrement())
  metric   String
  value    Float
  date     DateTime
  metadata String?
  userId   Int?
  user     user?    @relation(fields: [userId], references: [id], map: "Analytics_userId_fkey")

  @@index([userId], map: "Analytics_userId_fkey")
}

model badge {
  id          Int         @id @default(autoincrement())
  name        String
  description String
  icon        String
  category    String
  roadmapId   Int?
  roadmap     roadmap?   @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  userbadge   userbadge[]

  @@index([roadmapId])
}

model challenge {
  id            Int             @id @default(autoincrement())
  title         String
  description   String
  type          String
  xpReward      Int
  startDate     DateTime
  endDate       DateTime
  conditions    String
  roadmapId     Int?
  roadmap       roadmap?        @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  userchallenge userchallenge[]

  @@index([roadmapId])
}

model leaderboard {
  id               Int                @id @default(autoincrement())
  name             String
  type             String
  startDate        DateTime
  endDate          DateTime
  leaderboardentry leaderboardentry[]
}

model leaderboardentry {
  id            Int         @id @default(autoincrement())
  leaderboardId Int
  userId        Int
  score         Int
  rank          Int?
  leaderboard   leaderboard @relation(fields: [leaderboardId], references: [id], map: "LeaderboardEntry_leaderboardId_fkey")
  user          user        @relation(fields: [userId], references: [id], map: "LeaderboardEntry_userId_fkey")

  @@index([leaderboardId], map: "LeaderboardEntry_leaderboardId_fkey")
  @@index([userId], map: "LeaderboardEntry_userId_fkey")
}

model roadmap {
  id              Int               @id @default(autoincrement())
  name            String
  description     String?
  isDefault       Boolean            @default(false)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  level           level[]
  achievement      achievement[]
  badge           badge[]
  challenge       challenge[]
  notification    notification[]
  userachievement userachievement[]
  userbadge       userbadge[]
  userchallenge   userchallenge[]

  @@index([isDefault])
}

model level {
  id        Int     @id @default(autoincrement())
  name      String
  totalXp   Int?
  roadmapId Int
  roadmap   roadmap @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  topic     topic[]

  @@unique([roadmapId, name], map: "Level_roadmapId_name_key")
  @@index([roadmapId])
}

model mentor {
  id         Int          @id @default(autoincrement())
  userId     Int          @unique(map: "Mentor_userId_key")
  expertise  String
  bio        String?
  rating     Float        @default(0)
  mentorship mentorship[]
}

model mentorship {
  id        Int       @id @default(autoincrement())
  mentorId  Int
  menteeId  Int
  status    String
  startDate DateTime  @default(now())
  endDate   DateTime?
  user      user      @relation(fields: [menteeId], references: [id], map: "Mentorship_menteeId_fkey")
  mentor    mentor    @relation(fields: [mentorId], references: [id], map: "Mentorship_mentorId_fkey")

  @@index([menteeId], map: "Mentorship_menteeId_fkey")
  @@index([mentorId], map: "Mentorship_mentorId_fkey")
}

model notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  title     String
  message   String
  type      String
  read      Boolean  @default(false)
  roadmapId Int?
  roadmap   roadmap? @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  user      user     @relation(fields: [userId], references: [id], map: "Notification_userId_fkey")

  @@index([userId], map: "Notification_userId_fkey")
  @@index([roadmapId])
}

model powerup {
  id          Int    @id @default(autoincrement())
  name        String
  description String
  effect      String
  duration    Int
  cost        Int
}

model progress {
  id          Int       @id @default(autoincrement())
  userId      Int
  topicId     Int
  completed   Boolean   @default(false)
  attempts    Int       @default(0)
  completedAt DateTime?
  difficulty  String?
  startedAt   DateTime?
  timeSpent   Int?
  topic       topic     @relation(fields: [topicId], references: [id], map: "Progress_topicId_fkey")
  user        user      @relation(fields: [userId], references: [id], map: "Progress_userId_fkey")

  @@unique([userId, topicId], map: "Progress_userId_topicId_key")
  @@index([topicId], map: "Progress_topicId_fkey")
}

model topic {
  id          Int        @id @default(autoincrement())
  name        String
  xp          Int
  levelId     Int
  videoUrl    String?
  description String?    @db.Text
  progress    progress[]
  resources   resource[]
  files       file[]
  level       level      @relation(fields: [levelId], references: [id], map: "Topic_levelId_fkey")

  @@index([levelId], map: "Topic_levelId_fkey")
}

model resource {
  id          Int     @id @default(autoincrement())
  title       String
  url         String
  type        String
  description String? @db.Text
  topicId     Int
  topic       topic   @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@index([topicId], map: "resource_topicId_idx")
}

model file {
  id         Int      @id @default(autoincrement())
  name       String
  path       String
  type       String
  size       Int
  topicId    Int
  uploadedAt DateTime @default(now()) @db.DateTime(3)
  topic      topic    @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@index([topicId], map: "file_topicId_idx")
}

model user {
  id               Int                @id @default(autoincrement())
  email            String             @unique(map: "User_email_key")
  password         String
  createdAt        DateTime           @default(now())
  currentStreak    Int                @default(0)
  lastActivityDate DateTime?
  longestStreak    Int                @default(0)
  analytics        analytics[]
  leaderboardentry leaderboardentry[]
  mentorship       mentorship[]
  notification     notification[]
  progress         progress[]
  userachievement  userachievement[]
  userbadge        userbadge[]
  userchallenge    userchallenge[]
  usercurrency     usercurrency?
}

model userachievement {
  id            Int         @id @default(autoincrement())
  userId        Int
  achievementId Int
  roadmapId     Int?
  roadmap       roadmap?    @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  earnedAt      DateTime    @default(now())
  achievement   achievement @relation(fields: [achievementId], references: [id], map: "UserAchievement_achievementId_fkey")
  user          user        @relation(fields: [userId], references: [id], map: "UserAchievement_userId_fkey")

  @@index([achievementId], map: "UserAchievement_achievementId_fkey")
  @@index([userId], map: "UserAchievement_userId_fkey")
  @@index([roadmapId])
  @@unique([userId, achievementId, roadmapId], map: "UserAchievement_userId_achievementId_roadmapId_key")
}

model userbadge {
  id       Int      @id @default(autoincrement())
  userId   Int
  badgeId  Int
  roadmapId Int?
  roadmap  roadmap? @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  earnedAt DateTime @default(now())
  badge    badge    @relation(fields: [badgeId], references: [id], map: "UserBadge_badgeId_fkey")
  user     user     @relation(fields: [userId], references: [id], map: "UserBadge_userId_fkey")

  @@index([badgeId], map: "UserBadge_badgeId_fkey")
  @@index([userId], map: "UserBadge_userId_fkey")
  @@index([roadmapId])
  @@unique([userId, badgeId, roadmapId], map: "UserBadge_userId_badgeId_roadmapId_key")
}

model userchallenge {
  id          Int       @id @default(autoincrement())
  challengeId Int
  userId      Int
  roadmapId   Int?
  roadmap     roadmap?  @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
  completed   Boolean   @default(false)
  completedAt DateTime?
  challenge   challenge @relation(fields: [challengeId], references: [id], map: "UserChallenge_challengeId_fkey")
  user        user      @relation(fields: [userId], references: [id], map: "UserChallenge_userId_fkey")

  @@index([challengeId], map: "UserChallenge_challengeId_fkey")
  @@index([userId], map: "UserChallenge_userId_fkey")
  @@index([roadmapId])
  @@unique([userId, challengeId, roadmapId], map: "UserChallenge_userId_challengeId_roadmapId_key")
}

model usercurrency {
  id     Int  @id @default(autoincrement())
  userId Int  @unique(map: "UserCurrency_userId_key")
  coins  Int  @default(0)
  gems   Int  @default(0)
  user   user @relation(fields: [userId], references: [id], map: "UserCurrency_userId_fkey")
}
